# gofus - 进度条优化改进日志

## 本次改进内容

### 1. 速率单位更改
- ✅ 将速率单位从 `/s` 改为 `req/sec`，更符合行业标准

### 2. 错误计数显示
- ✅ 在进度条中添加错误计数显示：`错误: 21`
- ✅ 实时统计并显示扫描过程中的错误数量

### 3. 进度条位置固定（核心改进）
- ✅ **解决了进度条被刷新到中间的根本问题**
- ✅ 实现了类似 `ffuf` 和 `gobuster` 的固定底部进度条
- ✅ 使用ANSI转义序列控制光标位置
- ✅ 结果输出和进度条完全分离

## 技术实现细节

### 进度条固定机制
1. **printResult函数**: 专门处理扫描结果输出，保护进度条不被干扰
   ```go
   func printResult(message string) {
       // 保存光标位置 → 清除进度条 → 输出结果 → 恢复进度条
   }
   ```

2. **光标控制**: 使用ANSI转义序列精确控制光标位置
   - `\033[s` - 保存光标位置
   - `\033[A` - 上移一行
   - `\033[K` - 清除当前行
   - `\033[u` - 恢复光标位置

3. **状态管理**: 添加 `statusBarActive` 标志管理进度条生命周期

### 输出同步
- 使用 `outputMutex` 互斥锁保护所有输出操作
- 确保进度条更新和结果输出不会冲突
- 保持终端输出的一致性

## 使用示例

```bash
# 编译
go build -o gofus.exe main.go

# 运行（示例）
./gofus.exe -u https://example.com -w test.txt -c 10
```

## 进度条显示格式

```
████████░░░░░░░ 65.4% | 速率: 245 req/sec | 已扫描: 1234/1887 | 剩余: 653 | 错误: 12 | ETA: 2s
```

包含信息：
- 可视化进度条
- 完成百分比
- 实时请求速率 (req/sec)
- 扫描进度 (已完成/总数)
- 剩余数量
- **错误计数** (新增)
- 预计剩余时间 (ETA)

## 问题解决状态

- ✅ 速率单位改为 req/sec
- ✅ 添加错误数显示
- ✅ **完全解决进度条位置漂移问题**
- ✅ 实现了专业级的命令行工具体验

现在进度条会始终固定在终端底部，不再会被其他输出内容刷新到中间位置。